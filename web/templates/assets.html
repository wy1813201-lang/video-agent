{% extends "base.html" %}
{% block title %}ç´ æåº“ - AIçŸ­å‰§è‡ªåŠ¨åŒ–{% endblock %}
{% block content %}
<h1>ç´ æåº“</h1>

<div style="display:flex;gap:12px;margin-bottom:24px;flex-wrap:wrap;align-items:center">
  <form method="GET" style="display:flex;gap:8px;flex:1;min-width:240px">
    <input type="text" name="q" value="{{ keyword }}" placeholder="æœç´¢ç´ æåç§°/æ ‡ç­¾..." style="flex:1">
    <input type="hidden" name="category" value="{{ current_category }}">
    <button type="submit" class="btn btn-primary" style="white-space:nowrap">æœç´¢</button>
  </form>

  <div style="display:flex;gap:8px;flex-wrap:wrap">
    <a href="/assets" class="btn {% if not current_category %}btn-primary{% else %}btn-outline{% endif %}">å…¨éƒ¨</a>
    {% for cat in categories %}
    <a href="/assets?category={{ cat }}{% if keyword %}&q={{ keyword }}{% endif %}"
       class="btn {% if current_category == cat %}btn-primary{% else %}btn-outline{% endif %}">
      {% if cat == 'character' %}è§’è‰²
      {% elif cat == 'scene' %}åœºæ™¯
      {% elif cat == 'prop' %}é“å…·
      {% elif cat == 'music' %}éŸ³ä¹
      {% elif cat == 'effect' %}ç‰¹æ•ˆ
      {% else %}å…¶ä»–{% endif %}
    </a>
    {% endfor %}
  </div>
</div>

{% if assets %}
<div class="card-grid">
  {% for a in assets %}
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:flex-start">
      <strong style="color:#fff;font-size:14px">{{ a.name }}</strong>
      <span class="badge
        {% if a.asset_type == 'image' %}badge-blue
        {% elif a.asset_type == 'video' %}badge-purple
        {% else %}badge-green{% endif %}">
        {{ a.asset_type }}
      </span>
    </div>

    <div class="meta" style="margin-top:10px">
      {% if a.category %}
      <span>ğŸ“
        {% if a.category == 'character' %}è§’è‰²
        {% elif a.category == 'scene' %}åœºæ™¯
        {% elif a.category == 'prop' %}é“å…·
        {% elif a.category == 'music' %}éŸ³ä¹
        {% elif a.category == 'effect' %}ç‰¹æ•ˆ
        {% else %}å…¶ä»–{% endif %}
      </span>
      {% endif %}
      {% if a.style %}<span>ğŸ¨ {{ a.style }}</span>{% endif %}
      {% if a.use_count %}<span>â™»ï¸ å¤ç”¨ {{ a.use_count }} æ¬¡</span>{% endif %}
      {% if a.file_size %}<span>{{ "%.1f"|format(a.file_size / 1024) }} KB</span>{% endif %}
    </div>

    {% if a.tags %}
    <div style="margin-top:10px;display:flex;gap:6px;flex-wrap:wrap">
      {% for tag in a.tags %}
      <span class="badge badge-gray">{{ tag }}</span>
      {% endfor %}
    </div>
    {% endif %}

    {% if a.description %}
    <p style="color:#888;font-size:12px;margin-top:8px">{{ a.description }}</p>
    {% endif %}

    <div style="margin-top:12px;font-size:11px;color:#555">
      {{ a.source }} Â· {{ a.created_at[:10] if a.created_at else '' }}
    </div>
  </div>
  {% endfor %}
</div>
{% else %}
<div class="empty">
  <div class="icon">ğŸ“¦</div>
  <p>
    {% if keyword or current_category %}
      æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„ç´ æ
    {% else %}
      ç´ æåº“ä¸ºç©ºï¼Œç”Ÿæˆé¡¹ç›®åç´ æä¼šè‡ªåŠ¨å…¥åº“
    {% endif %}
  </p>
</div>
{% endif %}
{% endblock %}
